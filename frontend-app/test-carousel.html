<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carousel Test - Direct Implementation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 0;
            padding: 2rem;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .message-bubble {
            background: #f0f0f0;
            border-radius: 18px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .products-scroll::-webkit-scrollbar {
            height: 8px;
        }
        .products-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .products-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        .products-scroll::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üé† Direct Carousel Test</h1>
        <p>This tests the carousel with your exact Python backend data format:</p>
        
        <div class="message-bubble" id="carousel-test">
            <div id="carousel-container">
                Loading carousel test...
            </div>
        </div>
    </div>

    <script>
        // Test data - EXACT format from your Python backend
        const testContent = `üõí Found 3 dining products for you!

1. Nature's Edge Live Edge Counter Height Dining/Sofa Table - $280.21
2. Bilboa Indigo/ Off White Slipcovered Dining Chair - $287.5
3. Belhaven Grey 9 Piece Dining Set w/Table & 8 Chairs - $1498

**CAROUSEL_DATA:** {"products": [{"name": "Nature's Edge Live Edge Counter Height Dining/Sofa Table", "sku": "533813235", "price": 280.21, "status": 2, "image_url": "https://www.woodstockoutlet.com/media/catalog/product/j/o/jofran-natures-edge-sofa-dining-table-1985-72-img1.jpg", "media_gallery_entries": [{"id": 30520, "media_type": "image", "label": null, "position": 0, "disabled": false, "types": ["small_image", "thumbnail", "swatch_image"], "file": "/j/o/jofran-natures-edge-sofa-dining-table-1985-72-img1.jpg"}], "custom_attributes": [{"attribute_code": "description", "value": "The Nature's Edge Live Edge Counter Height Dining Table"}]}, {"name": "Bilboa Indigo/ Off White Slipcovered Dining Chair", "sku": "045969352", "price": 287.5, "status": 2, "image_url": "https://www.woodstockoutlet.com/media/catalog/product/b/r/bramble-bilboa-slipcover-side-dining-chair-indigo-off-white-27932-SF205-OFW-right1.jpg", "media_gallery_entries": [{"id": 15630, "media_type": "image", "label": null, "position": 0, "disabled": false, "types": ["small_image", "thumbnail", "swatch_image"], "file": "/b/r/bramble-bilboa-slipcover-side-dining-chair-indigo-off-white-27932-SF205-OFW-right1.jpg"}], "custom_attributes": []}, {"name": "Belhaven Grey 9 Piece Dining Set w/Table & 8 Chairs", "sku": "424380346", "price": 1498, "status": 2, "image_url": "https://www.woodstockoutlet.com/media/catalog/product/l/e/legacy-belhaven-grey-9pc-dining-table-chairs-set-img1.jpg", "media_gallery_entries": [{"id": 57909, "media_type": "image", "label": null, "position": 0, "disabled": false, "types": ["small_image", "thumbnail", "swatch_image"], "file": "/l/e/legacy-belhaven-grey-9pc-dining-table-chairs-set-img1.jpg"}], "custom_attributes": []}]}`;

        // Direct carousel renderer function - SAME LOGIC AS REACT COMPONENT
        function renderDirectCarousel(content) {
            try {
                console.log('üî• DIRECT CAROUSEL RENDERER - Processing:', content.substring(0, 100));
                
                // Extract carousel data - MULTIPLE PATTERNS
                let carouselData = null;
                
                // Pattern 1: **CAROUSEL_DATA:** {json}
                const pattern1 = content.match(/\*\*CAROUSEL_DATA:\*\*\s*({.*})/s);
                if (pattern1) {
                    console.log('üé† Pattern 1 match:', pattern1[1].substring(0, 100));
                    carouselData = JSON.parse(pattern1[1]);
                }
                
                // Pattern 2: CAROUSEL_DATA: {json}  
                if (!carouselData) {
                    const pattern2 = content.match(/CAROUSEL_DATA:\s*({.*})/s);
                    if (pattern2) {
                        console.log('üé† Pattern 2 match:', pattern2[1].substring(0, 100));
                        carouselData = JSON.parse(pattern2[1]);
                    }
                }
                
                // Pattern 3: Any {"products": in the message
                if (!carouselData) {
                    const pattern3 = content.match(/({\"products\":\s*\[.*?\]})/s);
                    if (pattern3) {
                        console.log('üé† Pattern 3 match:', pattern3[1].substring(0, 100));
                        carouselData = JSON.parse(pattern3[1]);
                    }
                }

                if (!carouselData || !carouselData.products) {
                    console.error('‚ùå No carousel data found');
                    return '<div style="color: red;">‚ùå No carousel data found</div>';
                }

                console.log('üé† Found products:', carouselData.products.length);

                // Generate HTML directly
                const products = carouselData.products;
                
                const productCards = products.map((product, index) => {
                    const imageUrl = product.image_url || 'https://via.placeholder.com/300x200/002147/FFFFFF?text=Woodstock+Furniture';
                    const price = product.price ? `$${product.price}` : 'Price on request';
                    
                    return `
                      <div class="product-card" style="
                        background: rgba(248, 249, 250, 0.9);
                        border: 1px solid rgba(222, 226, 230, 0.5);
                        border-radius: 12px;
                        overflow: hidden;
                        margin: 0.5rem;
                        cursor: pointer;
                        transition: transform 0.3s ease;
                        min-width: 250px;
                        max-width: 280px;
                        flex-shrink: 0;
                      " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div class="product-image" style="height: 180px; overflow: hidden;">
                          <img src="${imageUrl}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover;" 
                               onerror="this.src='https://via.placeholder.com/300x200/002147/FFFFFF?text=Woodstock+Furniture'">
                        </div>
                        <div class="product-info" style="padding: 1rem;">
                          <h3 style="margin: 0 0 0.5rem 0; font-size: 0.9rem; font-weight: 600; color: #002147; line-height: 1.3;">
                            ${product.name || 'Product'}
                          </h3>
                          <p style="margin: 0 0 0.75rem 0; font-size: 1.1rem; font-weight: 700; color: #d32535;">
                            ${price}
                          </p>
                          ${product.sku ? `<p style="margin: 0; font-size: 0.75rem; color: #6c757d;">SKU: ${product.sku}</p>` : ''}
                        </div>
                      </div>
                    `;
                }).join('');

                const html = `
                    <div>
                        <div style="margin-bottom: 1rem;">
                            <p style="white-space: pre-wrap; line-height: 1.5; margin: 0;">
                                ${content.split('**CAROUSEL_DATA:**')[0].trim()}
                            </p>
                        </div>
                        <div class="direct-carousel-container" style="margin: 1rem 0;">
                          <div class="carousel-header" style="
                            background: linear-gradient(135deg, #002147, #1a365d);
                            color: white;
                            padding: 1rem;
                            border-radius: 12px 12px 0 0;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            font-weight: 600;
                          ">
                            <i class="fas fa-shopping-cart"></i>
                            <span>üõí Found ${products.length} Products</span>
                          </div>
                          <div class="carousel-content" style="
                            background: rgba(248, 249, 250, 0.8);
                            border: 1px solid rgba(222, 226, 230, 0.5);
                            border-top: none;
                            border-radius: 0 0 12px 12px;
                            padding: 1rem;
                          ">
                            <div class="products-scroll" style="
                              display: flex;
                              gap: 1rem;
                              overflow-x: auto;
                              padding: 0.5rem 0;
                              scrollbar-width: thin;
                            ">
                              ${productCards}
                            </div>
                          </div>
                        </div>
                    </div>
                `;

                console.log('üé† Generated HTML length:', html.length);
                return html;
                
            } catch (error) {
                console.error('‚ùå Direct carousel error:', error);
                return `<div style="color: red;">‚ùå Carousel error: ${error.message}</div>`;
            }
        }

        // Test the carousel
        console.log('üî• Starting carousel test...');
        const carouselHTML = renderDirectCarousel(testContent);
        document.getElementById('carousel-container').innerHTML = carouselHTML;
        console.log('‚úÖ Carousel test complete!');
    </script>
</body>
</html>
